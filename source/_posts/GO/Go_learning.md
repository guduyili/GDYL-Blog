---
title: Go_learning
date: 2025-10-22
categories: 
- Go
tag:
- learning
---

<!-- toc -->

[TOC]

# Web Gee

## HTTP基础与上下文

![image-20251023165937459](./../../img/image-20251023165937459.png)

- **context**：封装`*http.Request`和`http.ResponseWriter`，以及解析动态路由，中间件。

  Context随着每一个请求的出现二产生，请求的结束而销毁，和当前i请求强相关的信息都应当由Context承载

- **router**：

​		![image-20251023210418956](./../../img/image-20251023210418956.png)

![image-20251023172424345](./../../img/image-20251023172424345.png)

​					![image-20251023172534028](./../../img/image-20251023172534028.png)

​					![image-20251023210405201](./../../img/image-20251023210405201.png)



## Trie树（前缀树）

![image-20251023211409726](./../../img/image-20251023211409726.png)

每一段可作为前缀树的一个节点，通过树结构查询，如果中间某一层的节点都不满足条件，那么就说明没有匹配到的路由，查询结束

动态路由实现一下两个功能。

- 参数匹配`:`.例如 `/p/:lang/doc`，可以匹配 `/p/c/doc` 和 `/p/go/doc`
- 通配`*`.例如 `/static/*filepath`，可以匹配`/static/fav.ico`，也可以匹配`/static/js/jQuery.js`，这种模式常用于静态服务器，能够递归地匹配子路径。

### 注册与匹配

开发服务时，注册路由规则，映射handler； 访问时，匹配路由规则

**插入**：递归查找每一层的节点，如果没有匹配到当前`part`节点，则新建一个，有一点需要注意，`/p/:lang/doc`只有在第三层节点，即`doc`节点，`pattern`才会设置为`/p/:lang/doc`。`p`和`:lang`节点的`pattern`属性皆为空。因此，当匹配结束时，我们可以使用`n.pattern == ""`来判断路由规则是否匹配成功。例如，`/p/python`虽能成功匹配到`:lang`，但`:lang`的`pattern`值为空，因此匹配失败。

**查询**：递归查询每一层的节点，退出规则为，匹配到`*`,匹配失败，或是匹配到了第`len(parts)`层节点





